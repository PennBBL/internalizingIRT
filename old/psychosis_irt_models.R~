### This script explores the measurement invariance characteristics of 1-, 2- and 3-PL
### models for psychosis items by children and their parents. It establishes if the item
### location parameters are invariant across sex, as reported by the children and their
### parents. If the 2- or 3-PL models turn out to be appropriate, it will also characterize
### the discrimination and lower-bound parameters' invariance status.
###
### Ellyn Butler
### March 3, 2019

# Load the data 
#df <- read.csv("/home/tymooore/n14513_GOASSESS_Screener_nontext_corrected_for_scala_20131021_redcap_pid272_fixed_20131101_notredcap.csv")
df <- read.csv("/home/butellyn/parentchild_psychopathology/data/GOA_itemwise_for_reporter_agreement.csv") # March 14, 2019: Use a validated version!!!! Which you will have to create
#demo <- read.csv("/home/butellyn/age_prediction/data/n9498_demographics_go1_20161212.csv")

# load packages
library('psych')
source('/home/butellyn/goassess_validation/depression/find_bad_bblids.R')

### ============ Depression ============ ###
#Q: ".", "7" and "9" all missing?
#DEP 001-008, 10-17, 20: 0 or 1
#DEP 018-019: 0-9

######## Middle Proband (11-17) ########
# Choose how to fix your data
depcols <- colnames(df)[grepl("DEP", colnames(df))][1:26]
dep_df <- df[df$INTERVIEW_TYPE == "MP",c("PROBAND_BBLID", depcols)]
names(dep_df)[names(dep_df) == 'PROBAND_BBLID'] <- 'bblid'
dep_df <- merge(dep_df, demo, by='bblid')
dep_df$ageAtClinicalAssess1 <- dep_df$ageAtClinicalAssess1/12

rownames(dep_df) <- 1:nrow(dep_df)



# Filter for necessary variables
dep_mp_df <- dep_df[dep_df$INTERVIEW_TYPE == "MP",c("PROBAND_BBLID", "DEP001", "DEP002", "DEP003", "DEP004", "DEP005", "DEP006", "DEP007", "DEP008", "DEP010", "DEP011", "DEP012", "DEP013", "DEP014", "DEP015", "DEP016", "DEP017", "DEP018", "DEP019", "DEP020")]
names(dep_mp_df)[names(dep_mp_df) == 'PROBAND_BBLID'] <- 'bblid'
dep_mp_df <- merge(dep_mp_df, demo, by="bblid")
dep_mp_df <- dep_mp_df[,!(names(dep_mp_df) %in% c("ethnicity", "ageAtCnb1", "edu1", "fedu1", "medu1", "handednessv2"))]


# fit 1PL
items <- dep_mp_df[,grep("DEP", colnames(dep_mp_df))]


# Middle Informant
